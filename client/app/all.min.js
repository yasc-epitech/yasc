"use strict";angular.module("yascApp",["ngCookies","ngResource","ngSanitize","ngRoute","btford.socket-io","ui.bootstrap"]).config(function(t,e,n){t.otherwise({redirectTo:"/"}),e.html5Mode(!0),n.interceptors.push("authInterceptor")}).factory("authInterceptor",function(t,e,n,a){return{request:function(t){return t.headers=t.headers||{},n.get("token")&&(t.headers.Authorization="Bearer "+n.get("token")),t},responseError:function(t){return 401===t.status?(a.path("/login"),n.remove("token"),e.reject(t)):e.reject(t)}}}).run(function(t,e,n){t.$on("$routeChangeStart",function(t,a){n.isLoggedInAsync(function(t){a.authenticate&&!t&&e.path("/login")})})}),angular.module("yascApp").config(function(t){t.when("/login",{templateUrl:"app/account/login/login.html",controller:"LoginCtrl"}).when("/signup",{templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl"}).when("/settings",{templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:!0})}),angular.module("yascApp").controller("LoginCtrl",function(t,e,n,a){t.user={},t.errors={},t.login=function(a){t.submitted=!0,a.$valid&&e.login({email:t.user.email,password:t.user.password}).then(function(){n.path("/")})["catch"](function(e){t.errors.other=e.message})},t.loginOauth=function(t){a.location.href="/auth/"+t}}),angular.module("yascApp").controller("SettingsCtrl",function(t,e,n){t.errors={},t.changePassword=function(e){t.submitted=!0,e.$valid&&n.changePassword(t.user.oldPassword,t.user.newPassword).then(function(){t.message="Password successfully changed."})["catch"](function(){e.password.$setValidity("mongoose",!1),t.errors.other="Incorrect password",t.message=""})}}),angular.module("yascApp").controller("SignupCtrl",function(t,e,n,a){t.user={},t.errors={},t.register=function(a){t.submitted=!0,a.$valid&&e.createUser({name:t.user.name,email:t.user.email,password:t.user.password}).then(function(){n.path("/")})["catch"](function(e){e=e.data,t.errors={},angular.forEach(e.errors,function(e,n){a[n].$setValidity("mongoose",!1),t.errors[n]=e.message})})},t.loginOauth=function(t){a.location.href="/auth/"+t}}),angular.module("yascApp").controller("AdminCtrl",function(t,e,n,a){t.users=a.query(),t["delete"]=function(e){a.remove({id:e._id}),angular.forEach(t.users,function(n,a){n===e&&t.users.splice(a,1)})}}),angular.module("yascApp").config(function(t){t.when("/admin",{templateUrl:"app/admin/admin.html",controller:"AdminCtrl"})}),angular.module("yascApp").controller("GenresCtrl",function(t,e,n){t.genres=[],e.get("/api/genres").success(function(e){t.genres=e,n.syncUpdates("genre",t.genres)}),t.deleteGenre=function(n){e["delete"]("/api/genres/"+n._id),_.remove(t.genres,function(t){return t._id===n._id})},t.addGenre=function(){if(""!==t.newGenre){var n={name:t.newGenre};e.post("/api/genres",n),t.newGenre="",t.genres.push(n)}},t.$on("$destroy",function(){n.unsyncUpdates("genre")})}),angular.module("yascApp").config(function(t){t.when("/genres",{templateUrl:"app/genres/genres.html",controller:"GenresCtrl"})}),angular.module("yascApp").controller("MainCtrl",function(t,e,n){t.awesomeThings=[],t.awesomeTracks=[],e.get("/api/things").success(function(e){t.awesomeThings=e,n.syncUpdates("thing",t.awesomeThings)}),e.get("/api/tracks").success(function(e){t.awesomeTracks=e,n.syncUpdates("track",t.awesomeTracks)}),t.deleteTrack=function(t){e["delete"]("/api/tracks/"+t._id)},t.addThing=function(){""!==t.newThing&&(e.post("/api/things",{name:t.newThing}),t.newThing="")},t.deleteThing=function(t){e["delete"]("/api/things/"+t._id)},t.$on("$destroy",function(){n.unsyncUpdates("track"),n.unsyncUpdates("thing")})}),angular.module("yascApp").config(function(t){t.when("/",{templateUrl:"app/main/main.html",controller:"MainCtrl"})}),angular.module("yascApp").controller("PlaylistCtrl",function(t,e,n){t.playlists=[],e.get("/api/playlists").success(function(e){t.playlists=e,n.syncUpdates("playlist",t.playlists)}),t.deletePlaylist=function(n){e["delete"]("/api/playlists/"+n._id),_.remove(t.playlists,function(t){return t._id===n._id})},t.addPlaylist=function(){if(""!==t.newPlaylist){var n={title:t.newPlaylist};e.post("/api/playlists",n),t.newPlaylist="",t.playlists.push(n)}},t.$on("$destroy",function(){n.unsyncUpdates("playlist")})}).controller("PlaylistDetailCtrl",function(t,e,n){e.playlist={},e.tracks={};var a=n.playlist_id;t.get("/api/playlists/"+a).success(function(t){e.playlist=t}),t.get("/api/tracks/").success(function(t){e.tracks=t}),e.playTrack=function(t){var e=document.getElementById("sc-widget"),n=SC.Widget(e);n.load("http://api.soundcloud.com/tracks/"+t.url,{show_artwork:!1,auto_play:!0})}}),angular.module("yascApp").config(function(t){t.when("/playlist",{templateUrl:"app/playlist/playlist.list.html",controller:"PlaylistCtrl"}).when("/playlist/:playlist_id",{templateUrl:"app/playlist/playlist.detail.html",controller:"PlaylistDetailCtrl"})}),angular.module("yascApp").controller("TracksCtrl",function(t,e,n,a){t.tracks=[],e.get("/api/tracks").success(function(e){t.tracks=e,a.syncUpdates("track",t.tracks)}),t.deleteTrack=function(t){e["delete"]("/api/tracks/"+t._id)},t.addTrack=function(){""!==t.newTrack&&(e.post("/api/tracks",{title:t.newTrack}),t.newTrack="")},t.gotoTrack=function(t){n.path("/tracks/"+t)},t.$on("$destroy",function(){a.unsyncUpdates("track")})}).controller("TrackDetailCtrl",function(t,e,n){t.track={};var a=n.track_id;e.get("/api/tracks/"+a).success(function(e){t.track=e;var n=document.getElementById("sc-widget"),a=SC.Widget(n);a.load("http://api.soundcloud.com/tracks/"+e.url,{show_artwork:!0,auto_play:!0})})}),angular.module("yascApp").config(function(t){t.when("/tracks",{templateUrl:"app/tracks/track.list.html",controller:"TracksCtrl"}).when("/tracks/:track_id",{templateUrl:"app/tracks/track.detail.html",controller:"TrackDetailCtrl"})});
